# ì´ë¯¸ì§€-í‚¤ì›Œë“œ ë¶ˆì¼ì¹˜ ê²€ì¦ ì‹œìŠ¤í…œ (v7.7.1)

**ì‘ì„±ì¼:** 2026-01-02  
**ë²„ì „:** v7.7.1  
**ëª©ì :** ì‚¬ìš©ìê°€ ì˜ë„ì  ë˜ëŠ” ì‹¤ìˆ˜ë¡œ ê´€ë ¨ ì—†ëŠ” ì´ë¯¸ì§€ì™€ í‚¤ì›Œë“œë¥¼ ì—…ë¡œë“œí–ˆì„ ë•Œ ì²˜ë¦¬ ë°©ë²•

---

## ğŸ¯ ë¬¸ì œ ìƒí™©

**ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤:**
- ğŸ“¸ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€: ë Œíƒˆ ìŠ¤íŠœë””ì˜¤ ì¸í…Œë¦¬ì–´ (ê±°ì‹¤, ìì—°ê´‘)
- ğŸ·ï¸ ì…ë ¥í•œ í‚¤ì›Œë“œ: "í™”ì¥í’ˆ", "ë³´ìŠµí¬ë¦¼", "ìŠ¤í‚¨ì¼€ì–´"
- âŒ ê²°ê³¼: ì´ë¯¸ì§€ì™€ í‚¤ì›Œë“œê°€ ì „í˜€ ë§ì§€ ì•ŠìŒ

**ê¸°ì¡´ ë¬¸ì œ:**
1. ì‹œìŠ¤í…œì´ ì–µì§€ë¡œ ì½˜í…ì¸ ë¥¼ ìƒì„±í•˜ë ¤ ì‹œë„
2. ì´ë¯¸ì§€ ë¶„ì„ ì˜¤ë¥˜ ë°œìƒ (Maximum call stack size exceeded)
3. ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ íŒì—… í‘œì‹œ (503 Service Unavailable)
4. ì‚¬ìš©ìëŠ” ì›ì¸ì„ ì•Œ ìˆ˜ ì—†ìŒ

---

## âœ… í•´ê²° ë°©ë²•

### **1ë‹¨ê³„: ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€ ì²˜ë¦¬ ê°œì„ **

**ë¬¸ì œ:** `String.fromCharCode(...array)` ì‚¬ìš© ì‹œ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°  
**í•´ê²°:** ì²­í¬ ë‹¨ìœ„ ë³€í™˜ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬

```typescript
// src/gemini.ts (Line 13-23)
const bytes = new Uint8Array(arrayBuffer);

// ì²­í¬ ë‹¨ìœ„ë¡œ ë³€í™˜í•˜ì—¬ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš° ë°©ì§€
let binary = '';
const chunkSize = 8192;
for (let i = 0; i < bytes.length; i += chunkSize) {
  const chunk = bytes.slice(i, i + chunkSize);
  binary += String.fromCharCode.apply(null, Array.from(chunk));
}
const base64 = btoa(binary);
```

---

### **2ë‹¨ê³„: í•˜ì´ë¸Œë¦¬ë“œ AI ê²€ì¦ ì‹œìŠ¤í…œ**

**ì´ë¯¸ì§€-í‚¤ì›Œë“œ ë§¤ì¹­ ë¶„ì„:**

```typescript
// src/index.tsx (Line 565-668)

// 1. ì´ë¯¸ì§€ ë¶„ì„ (Gemini Flash)
const imageAnalyses = await Promise.all(
  images.map(async (imageBase64: string, index: number) => {
    try {
      const description = await analyzeImageWithGemini(geminiApiKey, imageBase64);
      return { index: index + 1, description };
    } catch (error: any) {
      return {
        index: index + 1,
        description: `[ë¶„ì„ ì‹¤íŒ¨] ì´ë¯¸ì§€ ${index + 1}ì€(ëŠ”) ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`,
        failed: true,
      };
    }
  })
);

// 2. í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ ë¶„ì„ (GPT-4o)
const strategyResponse = await openai.chat.completions.create({
  model: 'gpt-4o',
  messages: [{
    role: 'user',
    content: `
    ğŸ“¸ ì´ë¯¸ì§€ ë¶„ì„ ê²°ê³¼:
    ${combinedImageDescription}
    
    ğŸ“ ì‚¬ìš©ì ì…ë ¥ ì •ë³´:
    - í‚¤ì›Œë“œ: ${keywords}
    - ë¸Œëœë“œ: ${brand}
    - ì‚°ì—…: ${industry}
    
    ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ:
    {
      "isMatch": true/false,
      "confidence": 0-100,
      "strategy": "integrated" | "image-first" | "keyword-first",
      "reason": "ì „ëµ ì„ íƒ ì´ìœ ",
      "imageSummary": "ì´ë¯¸ì§€ ì£¼ìš” ë‚´ìš©",
      "userInputSummary": "í‚¤ì›Œë“œ ìš”ì•½",
      "recommendation": "ì‚¬ìš©ì ì•ˆë‚´"
    }
    `
  }]
});

// 3. ê²€ì¦ ê²°ê³¼ ì²˜ë¦¬
if (matchingAnalysis.confidence < 40) {
  return c.json({
    success: false,
    requireConfirmation: true,
    validation: matchingAnalysis,
    message: 'âš ï¸ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ì™€ ì…ë ¥í•œ í‚¤ì›Œë“œê°€ ì„œë¡œ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
  });
}
```

---

### **3ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ ê²€ì¦ ëª¨ë‹¬**

**ê²€ì¦ ëª¨ë‹¬ í‘œì‹œ (app-v3-final.js Line 1993-1997):**

```javascript
// ê²€ì¦ ì‹¤íŒ¨ ì‹œ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
if (result.requireConfirmation && result.validation) {
  hideLoadingOverlay();
  showValidationModal(result.validation, formData);
  return;
}
```

**ëª¨ë‹¬ UI (Line 2490-2501):**

```javascript
function showValidationModal(validation, formData) {
  const modal = document.getElementById('validationModal');
  document.getElementById('validationReason').textContent = validation.reason;
  document.getElementById('validationImageSummary').textContent = validation.imageSummary;
  document.getElementById('validationUserInputSummary').textContent = validation.userInputSummary;
  document.getElementById('validationRecommendation').textContent = validation.recommendation;
  document.getElementById('validationConfidence').textContent = `${validation.confidence}% (ê¸°ì¤€: 40% ì´ìƒ ê¶Œì¥)`;
  
  modal.classList.remove('hidden');
}
```

---

## ğŸ“Š ê²€ì¦ ê¸°ì¤€

### **Confidence ê¸°ì¤€**

| Confidence | ì „ëµ | ì„¤ëª… | ì˜ˆì‹œ |
|-----------|------|------|------|
| **70-100%** | `integrated` (í†µí•©í˜•) | ì´ë¯¸ì§€ì™€ í‚¤ì›Œë“œê°€ ì™„ë²½íˆ ì¼ì¹˜ | í™”ì¥í’ˆ ì‚¬ì§„ + "ë³´ìŠµí¬ë¦¼" âœ… |
| **50-69%** | `image-first` (ì´ë¯¸ì§€ ì¤‘ì‹¬) | ì´ë¯¸ì§€ê°€ ë” í’ë¶€í•œ ì •ë³´ ì œê³µ | ë ˆìŠ¤í† ë‘ ì‚¬ì§„ + "ì¹´í˜" ğŸŸ¡ |
| **40-49%** | `keyword-first` (í‚¤ì›Œë“œ ì¤‘ì‹¬) | í‚¤ì›Œë“œ ìš°ì„ , ê²½ê³  í‘œì‹œ | í’ê²½ ì‚¬ì§„ + "IT ì„œë¹„ìŠ¤" âš ï¸ |
| **0-39%** | **ê²€ì¦ ì‹¤íŒ¨** | ì‚¬ìš©ì í™•ì¸ í•„ìš” | ì¹´í˜ ì‚¬ì§„ + "í™”ì¥í’ˆ" âŒ |

---

## ğŸ”§ ì‚¬ìš©ì ì„ íƒ ì˜µì…˜

### **ì˜µì…˜ 1: ì´ë¯¸ì§€ ë˜ëŠ” í‚¤ì›Œë“œ ìˆ˜ì •**
```
â†’ ëª¨ë‹¬ 'ë‹«ê¸°' ë²„íŠ¼ í´ë¦­
â†’ ì´ë¯¸ì§€ë¥¼ í‚¤ì›Œë“œì— ë§ê²Œ ë³€ê²½
â†’ ë˜ëŠ” í‚¤ì›Œë“œë¥¼ ì´ë¯¸ì§€ì— ë§ê²Œ ë³€ê²½
â†’ ë‹¤ì‹œ ìƒì„± ì‹œë„
```

### **ì˜µì…˜ 2: ê°•ì œ ì§„í–‰**
```
â†’ ëª¨ë‹¬ 'ê·¸ë˜ë„ ìƒì„±í•˜ê¸°' ë²„íŠ¼ í´ë¦­
â†’ forceGenerate: true í”Œë˜ê·¸ ì¶”ê°€
â†’ keyword-first ì „ëµìœ¼ë¡œ ìƒì„±
â†’ í‚¤ì›Œë“œ ì¤‘ì‹¬ ì½˜í…ì¸  ìƒì„±ë¨
```

---

## ğŸ¯ ì˜ˆìƒ ì‹œë‚˜ë¦¬ì˜¤

### **ì‹œë‚˜ë¦¬ì˜¤ 1: ì™„ì „ ì¼ì¹˜ (Confidence 90%)**

**ì…ë ¥:**
- ì´ë¯¸ì§€: ë Œíƒˆ ìŠ¤íŠœë””ì˜¤ ì¸í…Œë¦¬ì–´ ì‚¬ì§„
- í‚¤ì›Œë“œ: "ë ŒíƒˆìŠ¤íŠœë””ì˜¤", "ê°€ì¡±ì‚¬ì§„", "ìì—°ê´‘"

**ê²°ê³¼:**
- âœ… ê²€ì¦ í†µê³¼
- ì „ëµ: `integrated`
- ì¦‰ì‹œ ì½˜í…ì¸  ìƒì„±

---

### **ì‹œë‚˜ë¦¬ì˜¤ 2: ë¶€ë¶„ ì¼ì¹˜ (Confidence 55%)**

**ì…ë ¥:**
- ì´ë¯¸ì§€: ë ˆìŠ¤í† ë‘ ë‚´ë¶€ ì‚¬ì§„
- í‚¤ì›Œë“œ: "ì¹´í˜", "ë¸ŒëŸ°ì¹˜", "ë””ì €íŠ¸"

**ê²°ê³¼:**
- âœ… ê²€ì¦ í†µê³¼ (ê²½ê³  ì—†ìŒ)
- ì „ëµ: `image-first`
- ë ˆìŠ¤í† ë‘ ì¤‘ì‹¬ìœ¼ë¡œ ì½˜í…ì¸  ìƒì„±

---

### **ì‹œë‚˜ë¦¬ì˜¤ 3: ë¶ˆì¼ì¹˜ (Confidence 25%)**

**ì…ë ¥:**
- ì´ë¯¸ì§€: ì¹´í˜ ì¸í…Œë¦¬ì–´ ì‚¬ì§„
- í‚¤ì›Œë“œ: "í™”ì¥í’ˆ", "ë³´ìŠµí¬ë¦¼", "ìŠ¤í‚¨ì¼€ì–´"

**ê²°ê³¼:**
- âŒ ê²€ì¦ ì‹¤íŒ¨
- ëª¨ë‹¬ í‘œì‹œ:
  ```
  âš ï¸ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ì™€ ì…ë ¥í•œ í‚¤ì›Œë“œê°€ ì„œë¡œ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.
  
  ì´ë¯¸ì§€ ë¶„ì„: ì¹´í˜ ì¸í…Œë¦¬ì–´, ì›ëª© í…Œì´ë¸”, ì¡°ëª…
  ì…ë ¥ í‚¤ì›Œë“œ: í™”ì¥í’ˆ, ë³´ìŠµí¬ë¦¼, ìŠ¤í‚¨ì¼€ì–´
  
  ê¶Œì¥ì‚¬í•­: í™”ì¥í’ˆ ì œí’ˆ ì‚¬ì§„ìœ¼ë¡œ ë³€ê²½í•˜ê±°ë‚˜,
           ì¹´í˜ ê´€ë ¨ í‚¤ì›Œë“œë¡œ ìˆ˜ì •í•´ì£¼ì„¸ìš”.
  
  ì‹ ë¢°ë„: 25% (ê¸°ì¤€: 40% ì´ìƒ ê¶Œì¥)
  ```

**ì‚¬ìš©ì ì„ íƒ:**
1. **ë‹«ê¸°** â†’ ì´ë¯¸ì§€/í‚¤ì›Œë“œ ìˆ˜ì • í›„ ì¬ì‹œë„
2. **ê·¸ë˜ë„ ìƒì„±í•˜ê¸°** â†’ í‚¤ì›Œë“œ ì¤‘ì‹¬ìœ¼ë¡œ ê°•ì œ ìƒì„±

---

## ğŸš€ í…ŒìŠ¤íŠ¸ ë°©ë²•

### **í…ŒìŠ¤íŠ¸ 1: ì •ìƒ ì¼€ì´ìŠ¤**
```
1. http://localhost:3000 ì ‘ì†
2. ì´ë¯¸ì§€: í™”ì¥í’ˆ ì œí’ˆ ì‚¬ì§„ ì—…ë¡œë“œ
3. í‚¤ì›Œë“œ: "ë³´ìŠµí¬ë¦¼, ë¯¼ê°ì„±í”¼ë¶€, ìˆ˜ë¶„ê³µê¸‰"
4. ì½˜í…ì¸  ìƒì„± í´ë¦­
âœ… ì¦‰ì‹œ ìƒì„± ì™„ë£Œ
```

### **í…ŒìŠ¤íŠ¸ 2: ë¶ˆì¼ì¹˜ ì¼€ì´ìŠ¤**
```
1. http://localhost:3000 ì ‘ì†
2. ì´ë¯¸ì§€: í’ê²½ ì‚¬ì§„ ì—…ë¡œë“œ
3. í‚¤ì›Œë“œ: "IT ì„œë¹„ìŠ¤, í´ë¼ìš°ë“œ, AI"
4. ì½˜í…ì¸  ìƒì„± í´ë¦­
âš ï¸ ê²€ì¦ ëª¨ë‹¬ í‘œì‹œ
â†’ "ë‹«ê¸°" í´ë¦­ í›„ ìˆ˜ì •
â†’ "ê·¸ë˜ë„ ìƒì„±í•˜ê¸°" í´ë¦­ ì‹œ ê°•ì œ ìƒì„±
```

### **í…ŒìŠ¤íŠ¸ 3: ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€**
```
1. http://localhost:3000 ì ‘ì†
2. ì´ë¯¸ì§€: 3-5MB í¬ê¸° ì´ë¯¸ì§€ 7ì¥ ì—…ë¡œë“œ
3. í‚¤ì›Œë“œ: ê´€ë ¨ í‚¤ì›Œë“œ ì…ë ¥
4. ì½˜í…ì¸  ìƒì„± í´ë¦­
âœ… ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš° ì—†ì´ ì •ìƒ ì²˜ë¦¬
```

---

## ğŸ“ˆ ê°œì„  íš¨ê³¼

### **Before (v7.7.0)**
- âŒ ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€ â†’ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°
- âŒ ë¶ˆì¼ì¹˜ ì‹œ â†’ 503 ì—ëŸ¬
- âŒ ì‚¬ìš©ì â†’ "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜" ë©”ì‹œì§€ë§Œ í‘œì‹œ
- âŒ ì›ì¸ íŒŒì•… ë¶ˆê°€

### **After (v7.7.1)**
- âœ… ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€ â†’ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
- âœ… ë¶ˆì¼ì¹˜ ì‹œ â†’ ê²€ì¦ ëª¨ë‹¬ í‘œì‹œ
- âœ… ì‚¬ìš©ì â†’ ëª…í™•í•œ ì•ˆë‚´ ë©”ì‹œì§€
- âœ… ìˆ˜ì • ë˜ëŠ” ê°•ì œ ì§„í–‰ ì„ íƒ ê°€ëŠ¥

---

## ğŸ”— ê´€ë ¨ íŒŒì¼

- `src/gemini.ts` - ì´ë¯¸ì§€ ë¶„ì„ ë° Base64 ë³€í™˜
- `src/index.tsx` - í•˜ì´ë¸Œë¦¬ë“œ ê²€ì¦ ì‹œìŠ¤í…œ
- `public/static/app-v3-final.js` - í”„ë¡ íŠ¸ì—”ë“œ ê²€ì¦ ëª¨ë‹¬

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

1. âœ… ë¡œì»¬ í…ŒìŠ¤íŠ¸ (ë°©ê¸ˆ ì™„ë£Œ)
2. â³ Cloudflare Pages ë°°í¬
3. â³ í”„ë¡œë•ì…˜ í™˜ê²½ ê²€ì¦
4. â³ ì‹¤ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘

---

**í…ŒìŠ¤íŠ¸ URL:** http://localhost:3000  
**ê³µê°œ URL:** https://3000-i41cq3n8pxi55gachwryg-de59bda9.sandbox.novita.ai

**ìƒíƒœ:** âœ… ì¤€ë¹„ ì™„ë£Œ - ì§€ê¸ˆ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥!
