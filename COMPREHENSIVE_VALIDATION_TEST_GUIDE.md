# 🔍 종합 입력 검증 시스템 테스트 가이드 (v7.8.0)

## 📌 버전 정보
- **버전**: v7.8.0
- **작성일**: 2026-01-02
- **구현 상태**: ✅ 완료
- **테스트 준비**: ✅ 완료

---

## 🎯 구현 완료 기능

### ✅ 1. 모든 입력 항목 종합 검증
- 이미지 분석 결과
- 첨부 문서 내용 (PDF/DOCX)
- 브랜드명/서비스명
- 웹사이트 도메인
- 핵심 키워드
- 산업 분야
- 타겟 정보 (연령대/성별)
- 톤앤매너

### ✅ 2. 구체적 충돌 안내
**충돌 타입 6가지:**
- `image-keyword`: 이미지-키워드 불일치
- `image-brand`: 이미지-브랜드 불일치
- `document-keyword`: 문서-키워드 불일치
- `brand-website`: 브랜드-웹사이트 불일치
- `industry-keyword`: 산업-키워드 불일치
- `target-content`: 타겟-콘텐츠 불일치

**심각도 3단계:**
- `high` (높음): 명백한 모순, 즉시 수정 필요
- `medium` (중간): 주의 필요, 수정 권장
- `low` (낮음): 사소한 불일치, 무시 가능

**충돌 정보:**
- 충돌 타입 및 심각도
- 상세 설명 (100자 이내)
- 관련 항목 목록
- 구체적 수정 제안

### ✅ 3. 강제 진행 가능
- **검증 모달**: "무시하고 진행" 버튼 제공
- **품질 경고**: 예상 품질 수준 안내
- **크레딧 차감 안내**: 강제 진행 시에도 정상 차감

### ✅ 4. 자동 전략 선택
**신뢰도 기반:**
- `integrated` (70% 이상): 모든 요소 조화롭게 활용
- `image-first` (50-69%): 이미지 중심, 키워드 보조
- `keyword-first` (30-49%): 키워드 중심, 이미지 참고
- `document-first` (<30%, 문서 있음): 문서 중심

### ✅ 5. 향상된 검증 UI
- **신뢰도 시각화**: 색상으로 구분 (빨강/노랑/파랑)
- **충돌 목록**: 카드 형식으로 표시
- **수정 제안**: 각 충돌마다 구체적 제안
- **품질 경고**: 명확한 안내 메시지

---

## 🧪 테스트 시나리오

### 시나리오 A: 정상 케이스 (통과)
**입력:**
- 이미지: 화장품 사진 (보습크림 제품샷)
- 문서: "보습크림_상세정보.pdf"
- 브랜드: 설화수
- 웹사이트: www.sulwhasoo.com
- 키워드: 보습크림, 수분크림, 한방화장품
- 산업: 뷰티/화장품
- 타겟: 30대 여성

**예상 결과:**
```json
{
  "isConsistent": true,
  "overallConfidence": 85,
  "conflicts": [],
  "strategy": "integrated",
  "reason": "이미지, 문서, 키워드, 브랜드가 모두 보습크림/화장품과 일치하여 조화로운 콘텐츠 생성 가능",
  "recommendation": "입력 정보가 일관성 있습니다. 즉시 콘텐츠 생성을 진행하세요."
}
```

**동작:**
✅ 검증 모달 표시 안 함
✅ 즉시 콘텐츠 생성 진행
✅ `integrated` 전략 사용

---

### 시나리오 B: 불일치 케이스 (경고)
**입력:**
- 이미지: 카페 인테리어 사진
- 문서: "스킨케어_가이드.pdf"
- 브랜드: 테슬라
- 웹사이트: www.samsung.com
- 키워드: IT 컨설팅, 클라우드, AI
- 산업: 제조업
- 타겟: 60대 남성

**예상 결과:**
```json
{
  "isConsistent": false,
  "overallConfidence": 15,
  "conflicts": [
    {
      "type": "image-keyword",
      "severity": "high",
      "description": "카페 인테리어 이미지와 'IT 컨설팅' 키워드가 전혀 관련이 없습니다.",
      "items": ["카페 사진", "IT 컨설팅"],
      "suggestion": "IT 컨설팅에 맞는 사무실/기술 관련 이미지로 교체하세요."
    },
    {
      "type": "document-keyword",
      "severity": "high",
      "description": "스킨케어 가이드 문서와 'IT 컨설팅' 키워드가 완전히 다른 분야입니다.",
      "items": ["스킨케어 PDF", "IT 컨설팅"],
      "suggestion": "IT 컨설팅 관련 자료(회사 소개서, 서비스 안내 등)로 교체하세요."
    },
    {
      "type": "brand-website",
      "severity": "medium",
      "description": "'테슬라' 브랜드와 'samsung.com' 웹사이트가 일치하지 않습니다.",
      "items": ["테슬라", "samsung.com"],
      "suggestion": "테슬라의 정확한 웹사이트(tesla.com)를 입력하거나 브랜드명을 수정하세요."
    },
    {
      "type": "industry-keyword",
      "severity": "medium",
      "description": "'제조업' 산업과 'IT 컨설팅' 키워드가 일치하지 않습니다.",
      "items": ["제조업", "IT 컨설팅"],
      "suggestion": "산업 분야를 'IT/소프트웨어'로 변경하세요."
    }
  ],
  "strategy": "keyword-first",
  "reason": "이미지와 문서가 키워드와 관련이 없어 키워드 중심으로 콘텐츠 구성 필요",
  "recommendation": "입력 정보가 일관성이 없습니다. 이미지, 문서, 브랜드를 IT 컨설팅에 맞게 수정하거나, 키워드를 카페/제조업에 맞게 변경하세요."
}
```

**동작:**
⚠️ 검증 모달 표시
⚠️ 4개 충돌 목록 표시 (high 2개, medium 2개)
⚠️ 신뢰도: 15% (빨간색)
⚠️ 품질 경고 표시
✅ "무시하고 진행" 버튼 제공

---

### 시나리오 C: 강제 진행 (품질 경고)
**사용자 동작:**
1. 시나리오 B의 검증 모달에서
2. "무시하고 진행" 버튼 클릭

**백엔드 처리:**
```javascript
{
  forceGenerate: true,
  contentStrategy: 'keyword-first'  // 키워드 중심으로 강제 생성
}
```

**예상 결과:**
✅ 콘텐츠 생성 진행
✅ `keyword-first` 전략 사용
✅ 이미지는 참고만, 키워드 중심으로 생성
✅ 문서 내용 무시
✅ 크레딧 정상 차감 (1 크레딧)
⚠️ 품질 저하 가능 (키워드만으로 생성)

---

### 시나리오 D: 중간 신뢰도 (부분 일치)
**입력:**
- 이미지: 커피 사진
- 브랜드: 스타벅스 코리아
- 키워드: 커피, 카페, 음료
- 산업: 외식업
- 타겟: 20대-30대

**예상 결과:**
```json
{
  "isConsistent": true,
  "overallConfidence": 65,
  "conflicts": [
    {
      "type": "image-brand",
      "severity": "low",
      "description": "일반 커피 이미지이고 스타벅스 로고가 없습니다.",
      "items": ["커피 사진", "스타벅스"],
      "suggestion": "스타벅스 로고가 포함된 이미지를 사용하면 더 좋습니다."
    }
  ],
  "strategy": "image-first",
  "reason": "이미지와 키워드가 어느 정도 일치하나, 브랜드 특성이 약해 이미지 중심 전략 추천",
  "recommendation": "입력 정보가 대체로 일관성이 있습니다. 브랜드 특성을 강화하면 더 좋은 결과를 얻을 수 있습니다."
}
```

**동작:**
✅ 검증 모달 표시 안 함 (confidence 40% 이상)
✅ 즉시 콘텐츠 생성 진행
✅ `image-first` 전략 사용

---

## 🌐 테스트 URL

### 로컬 테스트
```
http://localhost:3000
```

### 공개 샌드박스 URL
```
https://3000-i41cq3n8pxi55gachwryg-de59bda9.sandbox.novita.ai
```

---

## ✅ 테스트 체크리스트

### 1. 정상 동작 확인
- [ ] 일관성 있는 입력 시 즉시 생성 (시나리오 A)
- [ ] 불일치 입력 시 검증 모달 표시 (시나리오 B)
- [ ] 강제 진행 시 콘텐츠 생성 (시나리오 C)
- [ ] 중간 신뢰도 시 적절한 전략 선택 (시나리오 D)

### 2. UI 확인
- [ ] 신뢰도 색상 구분 (빨강/노랑/파랑)
- [ ] 충돌 목록 카드 표시
- [ ] 충돌 타입 라벨 정확성
- [ ] 심각도 배지 색상
- [ ] 수정 제안 표시
- [ ] 품질 경고 메시지

### 3. 기능 확인
- [ ] "닫기" 버튼 동작
- [ ] "무시하고 진행" 버튼 동작
- [ ] 크레딧 차감 정상
- [ ] 월간 무료 사용 체크
- [ ] 생성 결과 표시
- [ ] 에러 핸들링

### 4. 문서 파싱 확인
- [ ] PDF 파일 업로드 및 파싱
- [ ] DOCX 파일 업로드 및 파싱
- [ ] 문서 내용 검증에 반영
- [ ] 문서-키워드 충돌 감지

### 5. 전략 선택 확인
- [ ] confidence 70+ → integrated
- [ ] confidence 50-69 → image-first
- [ ] confidence 30-49 → keyword-first
- [ ] confidence <30 + 문서 → document-first

---

## 🐛 알려진 이슈 및 제한사항

### 문서 파싱 제한
- **PDF**: 텍스트 기반 PDF만 지원 (스캔 이미지 X)
- **DOCX**: 최대 5MB
- **처리 시간**: 문서가 크면 +2-3초

### 검증 시간
- **이미지 분석**: 약 2-3초 (Gemini Flash)
- **종합 검증**: 약 1-2초 (GPT-4o)
- **총 검증 시간**: 약 3-5초

### 비용
- **종합 검증 1회**: 약 $0.03 (40원)
  - 이미지 분석: Gemini Flash ($0.01)
  - 종합 검증: GPT-4o ($0.02)
- **콘텐츠 생성**: 약 $0.20 (260원)

---

## 🎨 검증 모달 UI 스펙

### 색상 체계
```css
/* 신뢰도 구간별 색상 */
confidence < 30%  → 빨간색 (#dc2626)
confidence 30-49% → 노란색 (#f59e0b)
confidence 50-69% → 파란색 (#3b82f6)
confidence 70%+   → 녹색 (#059669)

/* 심각도별 색상 */
high severity   → 빨간색 (#dc2626)
medium severity → 노란색 (#f59e0b)
low severity    → 파란색 (#3b82f6)
```

### 레이아웃
1. **헤더**: 제목 + 닫기 버튼
2. **신뢰도 카드**: 배경색 + 신뢰도 퍼센트
3. **충돌 목록**: 카드 형식 (타입/심각도/설명/제안)
4. **전략 설명**: 선택된 전략 및 이유
5. **권장 사항**: 사용자 안내 메시지
6. **품질 경고**: 강제 진행 시 경고
7. **버튼**: 닫기 + 무시하고 진행

---

## 📊 예상 검증 통계

### 검증 결과 분포 예측
- **통과 (70%+)**: 약 60% - 사용자가 정상 입력
- **경고 (40-69%)**: 약 25% - 부분 불일치
- **차단 (40% 미만)**: 약 15% - 명백한 불일치

### 강제 진행 비율 예측
- **차단 케이스 중**: 약 30% 강제 진행 선택
- **이유**: 실험, 테스트, 의도적 불일치

---

## 🔄 업데이트 히스토리

### v7.8.0 (2026-01-02)
- ✅ 종합 입력 검증 시스템 구현
- ✅ 6가지 충돌 타입 감지
- ✅ 3단계 심각도 분류
- ✅ 구체적 수정 제안 제공
- ✅ 향상된 검증 UI
- ✅ 문서 파싱 통합 (PDF/DOCX)

### v7.7.2 (2026-01-02)
- ✅ Gemini API 모델명 수정 (gemini-1.5-flash-latest)
- ✅ 강제 진행 로직 개선

### v7.7.1 (2026-01-02)
- ✅ 대용량 이미지 처리 버그 수정
- ✅ 이미지-키워드 검증 기준 강화 (30% → 40%)

---

## 🚀 다음 단계

### 우선순위 1: 로컬 테스트 (지금)
1. 시나리오 A: 정상 케이스 테스트
2. 시나리오 B: 불일치 케이스 테스트
3. 시나리오 C: 강제 진행 테스트
4. 첨부 문서 파싱 테스트

### 우선순위 2: 프로덕션 배포 (다음)
1. Cloudflare Pages 배포
2. 환경 변수 설정
3. Google OAuth 설정
4. 프로덕션 검증

### 우선순위 3: 추가 개선 (선택)
1. 검증 결과 캐싱
2. 검증 성능 최적화
3. 더 정교한 충돌 감지
4. 사용자 피드백 수집

---

## 📞 지원

문제가 발생하면:
1. PM2 로그 확인: `pm2 logs webapp --nostream`
2. 브라우저 콘솔 확인
3. 이슈 보고

---

**작성**: Claude AI Agent
**버전**: v7.8.0
**날짜**: 2026-01-02
