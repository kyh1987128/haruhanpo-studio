# ğŸ¯ ìµœì¢… í”Œëœ: ë‹¨ì¼ êµ¬ë… + í¬ë ˆë”§ í•˜ì´ë¸Œë¦¬ë“œ

## ğŸ“‹ í™•ì • í”Œëœ êµ¬ì¡°

### ğŸ’ Pro í”Œëœ (ë‹¨ì¼ êµ¬ë…)
```
ì›” êµ¬ë…ë£Œ: â‚©9,900

í¬í•¨ ë‚´ìš©:
âœ… ì›” 50íšŒ ìƒì„± í¬í•¨
âœ… AI ì´ë¯¸ì§€ ë¶„ì„
âœ… 5ê°œ í”Œë«í¼ ë§ì¶¤ ì½˜í…ì¸ 
âœ… í‚¤ì›Œë“œ ìë™ ì¶”ì²œ (Gemini)

ì¶”ê°€ ìƒì„±:
ğŸ’° 1íšŒ = 1í¬ë ˆë”§ = â‚©100
```

### ğŸ“¦ ì¶”ê°€ í¬ë ˆë”§ íŒ¨í‚¤ì§€
```
ğŸ“¦ Starter: 10í¬ë ˆë”§ = â‚©900 (10% í• ì¸)
ğŸ“¦ Popular: 50í¬ë ˆë”§ = â‚©4,000 (20% í• ì¸) â­ ì¸ê¸°
ğŸ“¦ Pro: 100í¬ë ˆë”§ = â‚©7,000 (30% í• ì¸)
```

---

## ğŸ’° ì›ê°€ ë° ìˆ˜ìµ ë¶„ì„

### 1íšŒ ìƒì„± ì›ê°€
```
ì´ë¯¸ì§€ ë¶„ì„ (Gemini): â‚©0.72
í‚¤ì›Œë“œ ì¶”ì²œ (Gemini): â‚©2.74
ì½˜í…ì¸  ìƒì„± (Gemini): â‚©2.74
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ë³¸ ì›ê°€: â‚©6.20
ë³´ì • ì›ê°€ (1.3x): â‚©8.06
```

### êµ¬ë… í”Œëœ ìˆ˜ìµì„±
```
ì›” êµ¬ë…ë£Œ: â‚©9,900
í¬í•¨ ìƒì„±: 50íšŒ
ì›ê°€: â‚©403 (50íšŒ Ã— â‚©8.06)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ìˆœì´ìµ: â‚©9,497
ë§ˆì§„: 96% âœ…
```

### ì¶”ê°€ í¬ë ˆë”§ ìˆ˜ìµì„±
```
1í¬ë ˆë”§ = â‚©100
1íšŒ ì›ê°€ = â‚©8.06
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1íšŒë‹¹ ë§ˆì§„: â‚©91.94 (92%)

íŒ¨í‚¤ì§€ë³„ ë§ˆì§„:
â€¢ 10í¬ë ˆë”§ (â‚©900): â‚©819.40 ë§ˆì§„ (91%)
â€¢ 50í¬ë ˆë”§ (â‚©4,000): â‚©3,597 ë§ˆì§„ (90%)
â€¢ 100í¬ë ˆë”§ (â‚©7,000): â‚©6,194 ë§ˆì§„ (88%)
```

---

## ğŸ“Š ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„

### ì‹œë‚˜ë¦¬ì˜¤ 1: ë¼ì´íŠ¸ ìœ ì € (ì›” 30íšŒ ì‚¬ìš©)
```
ë¹„ìš©: â‚©9,900 (êµ¬ë…ë£Œë§Œ)
ì‚¬ìš©: 30íšŒ (í¬í•¨ë¶„ ë‚´)
ìš°ë¦¬ ì›ê°€: â‚©242 (30íšŒ Ã— â‚©8.06)
ìš°ë¦¬ ìˆ˜ìµ: â‚©9,658
ë§ˆì§„: 98%
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: í‰ê·  ìœ ì € (ì›” 50íšŒ ì‚¬ìš©)
```
ë¹„ìš©: â‚©9,900 (êµ¬ë…ë£Œë§Œ)
ì‚¬ìš©: 50íšŒ (í¬í•¨ë¶„ ë‚´)
ìš°ë¦¬ ì›ê°€: â‚©403 (50íšŒ Ã— â‚©8.06)
ìš°ë¦¬ ìˆ˜ìµ: â‚©9,497
ë§ˆì§„: 96%
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: í—¤ë¹„ ìœ ì € (ì›” 100íšŒ ì‚¬ìš©)
```
ë¹„ìš©: â‚©9,900 + â‚©4,000 = â‚©13,900
ì‚¬ìš©: 50íšŒ (í¬í•¨) + 50íšŒ (í¬ë ˆë”§)
ìš°ë¦¬ ì›ê°€: â‚©806 (100íšŒ Ã— â‚©8.06)
ìš°ë¦¬ ìˆ˜ìµ: â‚©13,094
ë§ˆì§„: 94%
```

### ì‹œë‚˜ë¦¬ì˜¤ 4: ìŠˆí¼ ìœ ì € (ì›” 200íšŒ ì‚¬ìš©)
```
ë¹„ìš©: â‚©9,900 + â‚©7,000 + â‚©4,000 = â‚©20,900
ì‚¬ìš©: 50íšŒ + 150íšŒ (í¬ë ˆë”§)
ìš°ë¦¬ ì›ê°€: â‚©1,612 (200íšŒ Ã— â‚©8.06)
ìš°ë¦¬ ìˆ˜ìµ: â‚©19,288
ë§ˆì§„: 92%
```

---

## ğŸ“ˆ ì›”ê°„ ìˆ˜ìµ ì‹œë®¬ë ˆì´ì…˜

### ë³´ìˆ˜ì  ì‹œë‚˜ë¦¬ì˜¤ (ì‚¬ìš©ì 100ëª…)
```
ì‚¬ìš©ì ë¶„í¬:
â€¢ ë¼ì´íŠ¸ ìœ ì € (30íšŒ): 40ëª…
â€¢ í‰ê·  ìœ ì € (50íšŒ): 40ëª…
â€¢ í—¤ë¹„ ìœ ì € (100íšŒ): 15ëª…
â€¢ ìŠˆí¼ ìœ ì € (200íšŒ): 5ëª…

êµ¬ë… ìˆ˜ìµ:
â€¢ 100ëª… Ã— â‚©9,900 = â‚©990,000

ì¶”ê°€ í¬ë ˆë”§ ìˆ˜ìµ:
â€¢ í—¤ë¹„ ìœ ì €: 15ëª… Ã— â‚©4,000 = â‚©60,000
â€¢ ìŠˆí¼ ìœ ì €: 5ëª… Ã— â‚©11,000 = â‚©55,000
â€¢ í•©ê³„: â‚©115,000

ì´ ìˆ˜ìµ: â‚©1,105,000

ì´ ì›ê°€:
â€¢ 40ëª… Ã— 30íšŒ = 1,200íšŒ â†’ â‚©9,672
â€¢ 40ëª… Ã— 50íšŒ = 2,000íšŒ â†’ â‚©16,120
â€¢ 15ëª… Ã— 100íšŒ = 1,500íšŒ â†’ â‚©12,090
â€¢ 5ëª… Ã— 200íšŒ = 1,000íšŒ â†’ â‚©8,060
â€¢ í•©ê³„: 5,700íšŒ â†’ â‚©45,942

ìˆœì´ìµ: â‚©1,059,058
ë§ˆì§„: 96%
```

### ì ê·¹ì  ì‹œë‚˜ë¦¬ì˜¤ (ì‚¬ìš©ì 300ëª…)
```
ì‚¬ìš©ì ë¶„í¬:
â€¢ ë¼ì´íŠ¸ ìœ ì € (30íšŒ): 120ëª…
â€¢ í‰ê·  ìœ ì € (50íšŒ): 120ëª…
â€¢ í—¤ë¹„ ìœ ì € (100íšŒ): 45ëª…
â€¢ ìŠˆí¼ ìœ ì € (200íšŒ): 15ëª…

êµ¬ë… ìˆ˜ìµ:
â€¢ 300ëª… Ã— â‚©9,900 = â‚©2,970,000

ì¶”ê°€ í¬ë ˆë”§ ìˆ˜ìµ:
â€¢ í—¤ë¹„ ìœ ì €: 45ëª… Ã— â‚©4,000 = â‚©180,000
â€¢ ìŠˆí¼ ìœ ì €: 15ëª… Ã— â‚©11,000 = â‚©165,000
â€¢ í•©ê³„: â‚©345,000

ì´ ìˆ˜ìµ: â‚©3,315,000

ì´ ì›ê°€:
â€¢ 17,100íšŒ Ã— â‚©8.06 = â‚©137,826

ìˆœì´ìµ: â‚©3,177,174
ë§ˆì§„: 96%
```

---

## ğŸ¯ ë¹„ì¦ˆë‹ˆìŠ¤ ì¥ì 

### 1. ì•ˆì •ì  ìˆ˜ìµ (êµ¬ë… ê¸°ë°˜)
- ë§¤ë‹¬ ì˜ˆì¸¡ ê°€ëŠ¥í•œ MRR (Monthly Recurring Revenue)
- ì‚¬ìš©ì 100ëª… = ìµœì†Œ â‚©990,000 ë³´ì¥

### 2. ìœ ì—°í•œ ì¶”ê°€ ìˆ˜ìµ (í¬ë ˆë”§)
- í—¤ë¹„ ìœ ì €ë¡œë¶€í„° ì¶”ê°€ ìˆ˜ìµ (20-40% ì¶”ê°€ ê¸°ëŒ€)
- ë§ˆì§„ ìœ ì§€ (90%+)

### 3. ë‹¨ìˆœí•œ ìš´ì˜
- í”Œëœ 1ê°œë§Œ ê´€ë¦¬
- êµ¬ë… vs í¬ë ˆë”§ ë¡œì§ë§Œ êµ¬í˜„
- ì‚¬ìš©ì í˜¼ë€ ìµœì†Œí™”

### 4. í™•ì¥ ìš©ì´
- ê¸°ì—…ìš© í”Œëœ ì¶”ê°€ ê°€ëŠ¥ (ì›” â‚©49,900, 300íšŒ í¬í•¨)
- API ì ‘ê·¼ íŒë§¤ ê°€ëŠ¥
- í™”ì´íŠ¸ë¼ë²¨ ì„œë¹„ìŠ¤ í™•ì¥ ê°€ëŠ¥

---

## ğŸ—‚ï¸ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### users í…Œì´ë¸” (ë‹¨ìˆœí™”)
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  name TEXT,
  
  -- êµ¬ë… ì •ë³´
  subscription_status TEXT DEFAULT 'active', -- 'active' | 'expired'
  subscription_started_at TIMESTAMPTZ DEFAULT NOW(),
  subscription_expires_at TIMESTAMPTZ,
  
  -- ì›”ê°„ í¬í•¨ íšŸìˆ˜
  monthly_included_count INT DEFAULT 50,
  monthly_used_count INT DEFAULT 0,
  monthly_reset_date DATE DEFAULT CURRENT_DATE,
  
  -- ì¶”ê°€ í¬ë ˆë”§
  credits INT DEFAULT 0,
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_users_subscription_status ON users(subscription_status);
CREATE INDEX idx_users_email ON users(email);
```

### credit_transactions í…Œì´ë¸” (ìµœì†Œí™”)
```sql
CREATE TABLE credit_transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  amount INT NOT NULL, -- +10, -1, +50 ë“±
  balance_after INT NOT NULL, -- ê±°ë˜ í›„ ì”ì•¡
  type TEXT NOT NULL, -- 'purchase' | 'usage'
  description TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_credit_transactions_user_id ON credit_transactions(user_id);
CREATE INDEX idx_credit_transactions_created_at ON credit_transactions(created_at DESC);
```

### RLS ì •ì±… (ë‹¨ìˆœí™”)
```sql
-- users í…Œì´ë¸”
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own profile"
ON users FOR SELECT
TO authenticated
USING (auth.uid() = id);

CREATE POLICY "Users can update own profile"
ON users FOR UPDATE
TO authenticated
USING (auth.uid() = id)
WITH CHECK (auth.uid() = id);

-- credit_transactions í…Œì´ë¸”
ALTER TABLE credit_transactions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own transactions"
ON credit_transactions FOR SELECT
TO authenticated
USING (auth.uid() = user_id);
```

---

## ğŸ”§ ë°±ì—”ë“œ ë¡œì§

### 1. ì‚¬ìš©ëŸ‰ ì°¨ê° ë¡œì§
```typescript
// src/index.tsx

async function deductUsage(
  supabase: SupabaseClient,
  userId: string
): Promise<{ success: boolean; message: string; remaining: { included: number; credits: number } }> {
  
  // ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
  const { data: user, error } = await supabase
    .from('users')
    .select('*')
    .eq('id', userId)
    .single();
  
  if (error || !user) {
    return { success: false, message: 'ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', remaining: { included: 0, credits: 0 } };
  }
  
  // ì›”ê°„ ë¦¬ì…‹ ì²´í¬
  const today = new Date().toISOString().split('T')[0];
  const currentMonth = today.substring(0, 7) + '-01';
  if (user.monthly_reset_date < currentMonth) {
    await supabase
      .from('users')
      .update({ 
        monthly_used_count: 0,
        monthly_reset_date: today
      })
      .eq('id', userId);
    
    user.monthly_used_count = 0;
  }
  
  // 1. êµ¬ë… í¬í•¨ íšŸìˆ˜ ë¨¼ì € ì‚¬ìš©
  if (user.monthly_used_count < user.monthly_included_count) {
    const { error: updateError } = await supabase
      .from('users')
      .update({ 
        monthly_used_count: user.monthly_used_count + 1,
        updated_at: new Date().toISOString()
      })
      .eq('id', userId);
    
    if (updateError) throw updateError;
    
    return {
      success: true,
      message: `êµ¬ë… í¬í•¨ íšŸìˆ˜ ì‚¬ìš© (${user.monthly_used_count + 1}/${user.monthly_included_count})`,
      remaining: {
        included: user.monthly_included_count - user.monthly_used_count - 1,
        credits: user.credits
      }
    };
  }
  
  // 2. í¬ë ˆë”§ ì°¨ê°
  if (user.credits > 0) {
    const newCredits = user.credits - 1;
    
    const { error: updateError } = await supabase
      .from('users')
      .update({ 
        credits: newCredits,
        updated_at: new Date().toISOString()
      })
      .eq('id', userId);
    
    if (updateError) throw updateError;
    
    // í¬ë ˆë”§ ì‚¬ìš© ì´ë ¥ ê¸°ë¡
    await supabase
      .from('credit_transactions')
      .insert({
        user_id: userId,
        amount: -1,
        balance_after: newCredits,
        type: 'usage',
        description: 'ì½˜í…ì¸  ìƒì„±'
      });
    
    return {
      success: true,
      message: `í¬ë ˆë”§ 1ê°œ ì°¨ê° (ë‚¨ì€ í¬ë ˆë”§: ${newCredits})`,
      remaining: {
        included: 0,
        credits: newCredits
      }
    };
  }
  
  // 3. ë‘˜ ë‹¤ ë¶€ì¡±
  return {
    success: false,
    message: 'ìƒì„± íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. í¬ë ˆë”§ì„ ì¶©ì „í•´ì£¼ì„¸ìš”.',
    remaining: {
      included: 0,
      credits: 0
    }
  };
}
```

### 2. í¬ë ˆë”§ ì¶©ì „ ë¡œì§
```typescript
// src/index.tsx

app.post('/api/credits/purchase', async (c) => {
  try {
    const body = await c.req.json();
    const { user_id, package_type } = body; // 'starter' | 'popular' | 'pro'
    
    const packages = {
      starter: { credits: 10, price: 900 },
      popular: { credits: 50, price: 4000 },
      pro: { credits: 100, price: 7000 }
    };
    
    const selectedPackage = packages[package_type];
    if (!selectedPackage) {
      return c.json({ error: 'ì˜ëª»ëœ íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤' }, 400);
    }
    
    // TODO: ì‹¤ì œ ê²°ì œ ì²˜ë¦¬ (Stripe, í† ìŠ¤í˜ì´ë¨¼ì¸  ë“±)
    // const paymentResult = await processPayment(user_id, selectedPackage.price);
    
    const supabase = createSupabaseAdmin(
      c.env.SUPABASE_URL,
      c.env.SUPABASE_SERVICE_KEY
    );
    
    // ì‚¬ìš©ì ì¡°íšŒ
    const { data: user } = await supabase
      .from('users')
      .select('credits')
      .eq('id', user_id)
      .single();
    
    if (!user) {
      return c.json({ error: 'ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404);
    }
    
    // í¬ë ˆë”§ ì¶”ê°€
    const newCredits = user.credits + selectedPackage.credits;
    
    await supabase
      .from('users')
      .update({ credits: newCredits })
      .eq('id', user_id);
    
    // ê±°ë˜ ì´ë ¥ ê¸°ë¡
    await supabase
      .from('credit_transactions')
      .insert({
        user_id,
        amount: selectedPackage.credits,
        balance_after: newCredits,
        type: 'purchase',
        description: `${package_type} íŒ¨í‚¤ì§€ êµ¬ë§¤ (â‚©${selectedPackage.price.toLocaleString()})`
      });
    
    return c.json({
      success: true,
      credits: newCredits,
      purchased: selectedPackage.credits,
      message: `${selectedPackage.credits}í¬ë ˆë”§ì´ ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤`
    });
    
  } catch (error: any) {
    console.error('í¬ë ˆë”§ ì¶©ì „ ì—ëŸ¬:', error);
    return c.json({ error: 'í¬ë ˆë”§ ì¶©ì „ ì‹¤íŒ¨', details: error.message }, 500);
  }
});
```

---

## ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ UI ì•ˆë‚´

### ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
```typescript
// currentUser ê°ì²´
{
  subscription_status: 'active',
  monthly_included_count: 50,
  monthly_used_count: 23,
  monthly_remaining: 27, // 50 - 23
  credits: 15
}

// UI í‘œì‹œ
"Pro í”Œëœ (27/50íšŒ ë‚¨ìŒ) + í¬ë ˆë”§ 15ê°œ"
```

### í¬ë ˆë”§ ì¶©ì „ ëª¨ë‹¬
```html
<div class="credit-packages">
  <div class="package">
    <h3>Starter</h3>
    <div class="price">â‚©900</div>
    <div class="credits">10í¬ë ˆë”§</div>
    <div class="discount">10% í• ì¸</div>
    <button>êµ¬ë§¤í•˜ê¸°</button>
  </div>
  
  <div class="package popular">
    <span class="badge">ì¸ê¸°</span>
    <h3>Popular</h3>
    <div class="price">â‚©4,000</div>
    <div class="credits">50í¬ë ˆë”§</div>
    <div class="discount">20% í• ì¸</div>
    <button>êµ¬ë§¤í•˜ê¸°</button>
  </div>
  
  <div class="package">
    <h3>Pro</h3>
    <div class="price">â‚©7,000</div>
    <div class="credits">100í¬ë ˆë”§</div>
    <div class="discount">30% í• ì¸</div>
    <button>êµ¬ë§¤í•˜ê¸°</button>
  </div>
</div>
```

---

## âœ… ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Supabase í…Œì´ë¸” ìƒì„± (users, credit_transactions)
- [ ] RLS ì •ì±… ì„¤ì •
- [ ] ë°±ì—”ë“œ ì‚¬ìš©ëŸ‰ ì°¨ê° ë¡œì§ êµ¬í˜„
- [ ] ë°±ì—”ë“œ í¬ë ˆë”§ ì¶©ì „ API êµ¬í˜„
- [ ] í”„ë¡ íŠ¸ì—”ë“œ UI ì—…ë°ì´íŠ¸ (êµ¬ë… ì •ë³´ í‘œì‹œ)
- [ ] í”„ë¡ íŠ¸ì—”ë“œ í¬ë ˆë”§ ì¶©ì „ ëª¨ë‹¬ êµ¬í˜„
- [ ] ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ ì—°ë™ (Stripe/í† ìŠ¤í˜ì´ë¨¼ì¸ )
- [ ] í…ŒìŠ¤íŠ¸ ë° ë°°í¬

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **Supabase ì‘ì—…**: í…Œì´ë¸” ìƒì„± ë° RLS ì„¤ì •
2. **ë°±ì—”ë“œ êµ¬í˜„**: ì‚¬ìš©ëŸ‰ ì°¨ê° + í¬ë ˆë”§ ì¶©ì „ ë¡œì§
3. **í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„**: UI ì—…ë°ì´íŠ¸ + í¬ë ˆë”§ ëª¨ë‹¬
4. **ê²°ì œ ì—°ë™**: Stripe ë˜ëŠ” í† ìŠ¤í˜ì´ë¨¼ì¸ 
5. **í…ŒìŠ¤íŠ¸**: ì „ì²´ í”Œë¡œìš° ê²€ì¦
6. **ëŸ°ì¹­**: í”„ë¡œë•ì…˜ ë°°í¬

---

**í”Œëœ í™•ì •! ì´ì œ êµ¬í˜„ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤!** ğŸ‰
